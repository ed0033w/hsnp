
<html lang="en">
<SCRIPT ID=clientEventHandlersJS LANGUAGE=javascript>

function btnDivShow_onclick() {
	div1.style.display='';
}

function btnDivH_onclick() {
	div1.style.display='none';
}

</SCRIPT>

  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="description" content="">
    <meta name="author" content="Dashboard">
    <meta name="keyword" content="Dashboard, Bootstrap, Admin, Template, Theme, Responsive, Fluid, Retina">

    <title>DASHGUM - Bootstrap Admin Template</title>

    <script src="https://www.gstatic.com/firebasejs/4.0.0/firebase.js"></script>
    <script>
    // Initialize Firebase
    var config = {
        apiKey: "AIzaSyBZWQTLkUTg91JtXHt_npsAPIHbM1dm7_o",
        authDomain: "hsnp-55606.firebaseapp.com",
        databaseURL: "https://hsnp-55606.firebaseio.com",
        projectId: "hsnp-55606",
        storageBucket: "hsnp-55606.appspot.com",
        messagingSenderId: "912083360147"
    };
    firebase.initializeApp(config);
    </script>

    <script type="text/javascript" src='https://cdn.rawgit.com/naptha/tesseract.js/1.0.10/dist/tesseract.js'></script>
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.2.1/jquery.min.js"></script>
   
    <link href="assets/css/bootstrap.css" rel="stylesheet">
   
    <link href="assets/font-awesome/css/font-awesome.css" rel="stylesheet" />
        

    
    <link href="assets/css/style.css" rel="stylesheet">
    <link href="assets/css/style-responsive.css" rel="stylesheet">

   
 
    <style> 
   
    input[type=text] {
        width: 150px;
        box-sizing: border-box;
        border: 2px solid #ccc;
        border-radius: 4px;
        font-size: 16px;
        background-color: white;
        background-image: url('searchicon.png');
        background-position: 10px 10px; 
        background-repeat: no-repeat;
        padding: 10px 10px 10px 20px;
        -webkit-transition: width 0.4s ease-in-out;
        transition: width 0.4s ease-in-out;
    }
    input[type=text]:focus {
        width: 100%;
    }

    </style>
  </head>

  <body>

  <section id="container" >
    
      <header class="header black-bg">
              <div class="sidebar-toggle-box">
                  <div class="fa fa-bars tooltips" data-placement="right" data-original-title="Toggle Navigation"></div>
              </div>
            <!--logo start-->
            <a href="mainPage.html" class="logo"><img src="hsnp.png" class="logo" width="40" style="margin-bottom: 5px"><b>HSNP</b></a>
            <!--logo end-->
            
         <div class="top-menu">
            	<ul class="nav pull-right top-menu" id="signoutSmtBtn">
                    <li><a class="logout" href="" id= "logoutDiv">Logout</a></li>
                    <li><a class="logout" href="login.html" id= "loginDiv">Login</a></li>
            	</ul>
                
                    
            	
            </div>
        </header>
      <!--header end-->
      
      <!-- **********************************************************************************************************************************************************
      MAIN SIDEBAR MENU
      *********************************************************************************************************************************************************** -->
      <!--sidebar start-->
      <aside>
          <div id="sidebar"  class="nav-collapse ">
              <!-- sidebar menu start-->
              <ul class="sidebar-menu" id="nav-accordion">
              
              	  <p class="centered"><a href="profile.html"><img src="hsnpw.jpg" class="img-circle" width="60"></a></p>
              	  <h5 class="centered" id="username"></h5>
              	  	
                  <li class="mt">
                      <a href="mainPage.html">
                          <i class="fa "></i>
                          <span>mainpage</span>
                      </a>
                  </li>

                  <li class="sub-menu" id = "personalPage">
                      <a href="personalPage.html" >
                          <i class="fa "></i>
                          <span>personal page</span>
                      </a>
                  </li>

                  <li class="sub-menu">
                      <a href="PostQuestion.html" >
                          <i class="fa"></i>
                          <span>post question</span>
                      </a>
                  </li>
                  <li class="sub-menu">
                      <a href="" >
                          <i class="fa "></i>
                          <span>subject</span>
                      </a>
                      <ul class="sub">
                          <li><a  href="">國文</a></li>
                          <li><a  href="">英文</a></li>
                          <li><a  href="">數學</a></li>
                          <li><a  href="">物理</a></li>
                          <li><a  href="">化學</a></li>
                          <li><a  href="">生物</a></li>
                          <li><a  href="">地科</a></li>
                          <li><a  href="">公民</a></li>
                          <li><a  href="">地理</a></li>
                          <li><a  href="">歷史</a></li>
                      </ul>
                  </li>
                  <li>
                  <input type="text" name="search" placeholder="Search..">
                  </li>
              </ul>
              <!-- sidebar menu end-->
          </div>
          
      </aside>
      <!--sidebar end-->
      
      <!-- **********************************************************************************************************************************************************
      MAIN CONTENT
      *********************************************************************************************************************************************************** -->
      <!--main content start-->
      
      <section id="main-content">
          <section class="wrapper site-min-height">
                <br>
                
                <div class="row mt">
                    <div class="col-lg-3">
                    </div>
          		<div class="col-lg-6">
          			<div class="form-panel">
                  	  <h3 class="mb text-center"><i class="fa fa-angle-right  "></i>  Post Your Question</h3>
                          <div class="form-horizontal tasi-form" >
                                <div class="form-group has-success">
                                    <div class="col-sm-2  col-lg-2 text-center" >Author</div>
                                    <div class="col-lg-9">
                                        <div id="author">Author</div>
                                    </div>
                                </div>
                                <div class="form-group has-warning">
                                    <div class="col-sm-2  col-lg-2 text-center" >Theme</div>
                                    <div class="col-lg-9">
                                        <input type="text" class="form-control" id="theme">
                                    </div>
                                </div>
                                <div class="form-group has-error">
                                    <div class="col-sm-2  col-lg-2 text-center" >Subject</div>
                                    <div class="col-lg-9">
                                                <select class="form-control" id="subject">
                                                <option>國文</option>
                                                <option>英文</option>
                                                <option>數學</option>
                                                <option>物理</option>
                                                <option>化學</option>
                                                <option>生物</option>
                                                <option>地科</option>
                                                <option>公民</option>
                                                <option>地理</option>
                                                <option>歷史</option>
                                                </select>
                                    </div>
                                </div>
                                <div class="form-group has-warning">
                                    <div class="col-sm-2  col-lg-2 text-center" >
                                        <a id="a1" href="javascript:;" onclick="change()">OCR圖像辨識</a>
                                    </div>
                                </div>
                                <div id="d1" style="display: none">
                                    <div class="form-group has-warning">
                                        <div class="col-sm-2  col-lg-2 text-center">OCR Image</div>
                                        <div class="col-lg-9">
                                            <input type = "file" name="fileOCR" id="fileOCR">
                                        </div>
                                </div>
                                <div class="form-group has-warning">
                                    <center><img id="input" src="" width="400px"/></center>
                                </div>
                                </div> 
                                <div class="form-group has-warning">
                                    <div class="col-sm-2  col-lg-2 text-center" >Your Problem</div>
                                        <div class="col-lg-9">
                                        <textarea rows="4" cols="60" placeholder="Content" id="question_text"></textarea>
                                    </div>
                                </div>
                                <div class="form-group has-warning">
                                    <div class="col-sm-2  col-lg-2 text-center" >Problem Image</div>
                                        <div class="col-lg-9">
                                        <input type = "file" name="file" id="file">
                                    </div>
                                </div>
                                <br><br>
                                <div class="form-group ">
                                    <div class="col-lg-6" >
                                    </div>
                                    <div class="col-sm-6  col-lg-6 text-center" >
                                        <button type="button" class="btn btn-success" id="postbtn"><h4>Post My Question</h4></button>
                                    </div>
                                </div>
                          </div>
          			</div><!-- /form-panel -->
          		</div><!-- /col-lg-12 -->
          	</div><!-- /row -->
		</section>
      </section><!-- /MAIN CONTENT -->

      <!--main content end-->
     
  </section>

    <!-- js placed at the end of the document so the pages load faster -->
    <script src="assets/js/jquery.js"></script>
    <script src="assets/js/bootstrap.min.js"></script>
    <script src="assets/js/jquery-ui-1.9.2.custom.min.js"></script>
    <script src="assets/js/jquery.ui.touch-punch.min.js"></script>
    <script class="include" type="text/javascript" src="assets/js/jquery.dcjqaccordion.2.7.js"></script>
    <script src="assets/js/jquery.scrollTo.min.js"></script>
    <script src="assets/js/jquery.nicescroll.js" type="text/javascript"></script>


    <!--common script for all pages-->
    <script src="assets/js/common-scripts.js"></script>

    <!--script for this page-->
  <script language="javascript">
      var postbtn = document.getElementById("postbtn");
      var author = document.getElementById("author");
      var theme = document.getElementById("theme");
      var username = document.getElementById("username");
      var question_text = document.getElementById("question_text");

      var input = document.getElementById("input");


      

       var storageRef = firebase.storage().ref();

        function handlefileselect(evt){
            var file = evt.target.files[0];
            var metedata={contentType: file.type};
            
            storageRef.child('public/'+file.name).put(file,metedata).then(function(snapshot){
                console.log('上傳完成',snapshot);

                storageRef.child('public/'+file.name).getDownloadURL().then(function(url){
                    console.log(url);
                    document.getElementById("input").src = url;
                    Tesseract.recognize(url,{
                        lang : 'chi_tra'
                    }).then(function(result){
                        question_text.value = result.text;
                        console.log(result);
                    });
                    
                });
                
                

            }).catch(function(error){
                    console.error('上傳失敗:',error);
            });
        }
    window.addEventListener('load',function(){
        document.getElementById('fileOCR').addEventListener('change',handlefileselect);
    });
     
      
    firebase.auth().onAuthStateChanged(function(user) {
         window.onload = function() {
            var myLi = document.getElementById("signoutSmtBtn").getElementsByTagName('li');

            var calls = [];
            calls[0] = function() { document.getElementById("logoutDiv").style.display = "block"; document.getElementById("loginDiv").style.display = "none";};
            calls[1] = function() { document.getElementById("loginDiv").style.display = "block"; document.getElementById("logoutDiv").style.display = "none";};
            
            for (i = 0; i < 2; i++) {
                
                myLi[i].addEventListener('click', calls[i], false);
            }
        };
  if (user) {
       document.getElementById("loginDiv").style.display = "none";
            document.getElementById("logoutDiv").style.display = "block";

            firebase.database().ref('/users/' + user.uid).once('value').then(function(snapshot) {
                username.textContent = snapshot.val().username;
                author.innerHTML = snapshot.val().username;
            });

             signoutSmtBtn.addEventListener("click",function(){
                firebase.auth().signOut().then(function() {
                  console.log("User sign out!");
                  alert("登出成功");
                 // window.location.href = 'blank.html';
                }, function(error) {
                  console.log("User sign out error!");
                  alert("登出失敗");
                })
            },false);
    // User is signed in.
        User = firebase.auth().currentUser;
        postbtn.addEventListener("click", function(){

            var file = document.getElementById('file').files[0];
            if(file){
                var metedata={contentType: file.type};
                storageRef.child('/users/' + user.uid + '/' + file.name).put(file,metedata).then(function(snapshot){
                    console.log('上傳完成'+snapshot);
                    storageRef.child('/users/' + user.uid + '/' + file.name).getDownloadURL().then(function(url){
                        console.log(url);
                        var x = document.getElementById("subject").selectedIndex;
                        var subject = document.getElementById("subject").options[x].text;
                        var newPostRef = firebase.database().ref('/posts').push(); // To get post id key.
                        newPostRef.set({
                            uid: User.uid,
                            id: newPostRef.key,
                            img: url,
                            author: username.textContent,
                            theme: theme.value,
                            subject: subject,
                            question_text : question_text.value
                        }).then(function(){
                            window.location.href = 'mainPage.html';
                        });
                    });
                    
                })
                    .catch(function(error){
                        console.error('上傳失敗:',error);
                });
            }else{
                var x = document.getElementById("subject").selectedIndex;
                var subject = document.getElementById("subject").options[x].text;
                var newPostRef = firebase.database().ref('/posts').push(); // To get post id key.
                newPostRef.set({
                    uid: User.uid,
                    id: newPostRef.key,
                    author: username.textContent,
                    theme: theme.value,
                    subject: subject,
                    question_text : question_text.value
                }).then(function(){
                    window.location.href = 'mainPage.html';
                });
            }

    })
 }
 else{
       document.getElementById("loginDiv").style.display = "block";
            document.getElementById("logoutDiv").style.display = "none";
            document.getElementById("personalPage").style.pointerEvents = "none"; 
               username.textContent = "未登入";
          document.getElementById("signout").textContent = "登入"
          console.log("User is not logined yet.");
 }
}); 


    
        
        
    </script>
    <script>
var isShow = false;
function change() {
	if(!isShow) {
		isShow = true;
		document.getElementById('d1').style.display='';
		document.getElementById('a1').innerText = "隱藏";
	}
	else {
		isShow = false;
		document.getElementById('d1').style.display='none';
		document.getElementById('a1').innerText = "OCR圖像辨識";
	}			
}
</script>
  </body>
</html>
