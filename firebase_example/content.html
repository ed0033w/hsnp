<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="description" content="">
    <meta name="author" content="Dashboard">
    <meta name="keyword" content="Dashboard, Bootstrap, Admin, Template, Theme, Responsive, Fluid, Retina">

    <title>DASHGUM - Bootstrap Admin Template</title>

    <script src="https://www.gstatic.com/firebasejs/4.0.0/firebase.js"></script>
    <script>
    // Initialize Firebase
    var config = {
        apiKey: "AIzaSyBZWQTLkUTg91JtXHt_npsAPIHbM1dm7_o",
        authDomain: "hsnp-55606.firebaseapp.com",
        databaseURL: "https://hsnp-55606.firebaseio.com",
        projectId: "hsnp-55606",
        storageBucket: "hsnp-55606.appspot.com",
        messagingSenderId: "912083360147"
    };
    firebase.initializeApp(config);
    </script>

   
    <link href="assets/css/bootstrap.css" rel="stylesheet">
   
    <link href="assets/font-awesome/css/font-awesome.css" rel="stylesheet" />
        
  <link href="assets/css/fuck.css" rel="stylesheet">
    
    <link href="assets/css/style.css" rel="stylesheet">
    <link href="assets/css/style-responsive.css" rel="stylesheet">

   
 
    <style> 
   
    input[type=text] {
        width: 150px;
        box-sizing: border-box;
        border: 2px solid #ccc;
        border-radius: 4px;
        font-size: 16px;
        background-color: white;
        background-image: url('searchicon.png');
        background-position: 10px 10px; 
        background-repeat: no-repeat;
        padding: 10px 10px 10px 20px;
        -webkit-transition: width 0.4s ease-in-out;
        transition: width 0.4s ease-in-out;
    }
    input[type=text]:focus {
        width: 100%;
    }

    </style>
  </head>

  <body>

    <script>
        window.fbAsyncInit = function() {
            FB.init({
                appId            : '1907047162897287',
                autoLogAppEvents : true,
                xfbml            : true,
                version          : 'v2.9'
            });
            FB.AppEvents.logPageView();
        };

        (function(d, s, id){
            var js, fjs = d.getElementsByTagName(s)[0];
            if (d.getElementById(id)) {return;}
            js = d.createElement(s); js.id = id;
            js.src = "https://connect.facebook.net/en_US/sdk.js";
            fjs.parentNode.insertBefore(js, fjs);
        }(document, 'script', 'facebook-jssdk'));
    </script>

  <section id="container" >
    
      <header class="header black-bg">
              <div class="sidebar-toggle-box">
                  <div class="fa fa-bars tooltips" data-placement="right" data-original-title="Toggle Navigation"></div>
              </div>
            <!--logo start-->
            <a href="index.html" class="logo"><b>HSNP</b></a>
            <!--logo end-->
            
            <div class="top-menu">
            	<ul class="nav pull-right top-menu" id="signoutSmtBtn">
                    <li><a class="logout" href="" id= "logoutDiv">Logout</a></li>
                    <li><a class="logout" href="login.html" id= "loginDiv">Login</a></li>
            	</ul>
                
                    
            	
            </div>
        </header>
      <!--header end-->
      
      <!-- **********************************************************************************************************************************************************
      MAIN SIDEBAR MENU
      *********************************************************************************************************************************************************** -->
      <!--sidebar start-->
      <aside>
          <div id="sidebar"  class="nav-collapse ">
              <!-- sidebar menu start-->
              <ul class="sidebar-menu" id="nav-accordion">
              
              	  <p class="centered"><a href="profile.html"><img src="assets/img/ui-sam.jpg" class="img-circle" width="60"></a></p>
              	  <h5 class="centered" id="username"></h5>
              	  	
                  <li class="mt">
                      <a href="mainPage.html">
                          <i class="fa "></i>
                          <span>mainpage</span>
                      </a>
                  </li>

                  <li class="sub-menu" >
                      <a href="personalPage.html"  id = "personalPage">
                          <i class="fa "></i>
                          <span>personal page</span>
                      </a>
                  </li>

                  <li class="sub-menu">
                      <a href="PostQuestion.html" >
                          <i class="fa"></i>
                          <span>post question</span>
                      </a>
                  </li>
                  <li class="sub-menu">
                      <a href="" >
                          <i class="fa "></i>
                          <span>subject</span>
                      </a>
                      <ul class="sub">
                          <li><a  href="">國文</a></li>
                          <li><a  href="">英文</a></li>
                          <li><a  href="">數學</a></li>
                          <li><a  href="">物理</a></li>
                          <li><a  href="">化學</a></li>
                          <li><a  href="">生物</a></li>
                          <li><a  href="">地科</a></li>
                          <li><a  href="">公民</a></li>
                          <li><a  href="">地理</a></li>
                          <li><a  href="">歷史</a></li>
                      </ul>
                  </li>
                  <li>
                  <input type="text" name="search" placeholder="Search..">
                  </li>
              </ul>
              <!-- sidebar menu end-->
          </div>
          
      </aside>
      <!--sidebar end-->
      
      <!-- **********************************************************************************************************************************************************
      MAIN CONTENT
      *********************************************************************************************************************************************************** -->
      <!-- ******HEADER****** --> 
  
      <!--main content start-->
      <section id="main-content" style="background-color:lightgray;">
          <section class="wrapper site-min-height">
              <br>

           <div class="primary col-md-1 col-sm-12 col-xs-12">
           </div>

           <div class="primary col-md-10 col-sm-12 col-xs-12">
               <section class="latest section">
                    <div class="section-inner" >

                        <div class="content">    
                                               
                            <div class="item featured text-left" id="articleCard">
                                <h2 class="heading" id="date" style="float:right;">2017/6/24</h2>
                                <h2 class="heading" id="subject">{{questionCards.subject}}</h2>
                                <h3 class="title" id="range" style="color:black;">{{questionCards.theme}}</h3>
                                <div>
                                    <button class="but" id="share_postbtn" align="right">Share</button>
                                </div>
                                <br>
                                <div class="">
                                    <img id="question_img" :src="questionCards.img" style="border:0px gray solid;" width="70%" height="42%">
                                </div>
                                    
                                <div class="desc text-left">
                                    <h3>說明</h3>                                   
                                    <p id="question_text" style="font-size:15px;">{{questionCards.question_text}}</p>
                                </div><!--//desc-->                          
                            </div><!--//item-->
                            <hr class="divider" />
                                
                            <!--動態生成回答-->
                            <section id="replyCard">
                                <div class="item row" v-for="card in questionCards">
                                    <div class="col-md-2 col-sm-2 col-xs-12 text-center">
                                        <img class="img-responsive" width="100" height="100" src="head1.jpg" style="display:block; margin:auto;">
                                        <h4>{{card.replyname}}</h4>
                                    </div>
                                    <div class="desc col-md-10 col-sm-10 col-xs-12">
                                            <button :onclick="'firebase.database().ref(\'/posts/'+card.article_id+'\').remove().then(function(){window.location.href = \'personalPage.html\';});'" class="butd">x</button>
                                            <h3 class="title">{{card.answer_theme}}</h3>
                                            <p style="font-size:15px;">{{card.answer_text}}</p>
                                            <button style="border-style:none; background-color:white;"><i class="fa fa-heart"></i></button>
                                            <nobr>145</nobr>
                                            <button style="border-style:none; background-color:white;"><i class="fa fa-times"></i></button>
                                            <nobr>12</nobr> 
                                    </div><!--//desc-->                          
                                </div><!--//item-->
                            </section>

                            <div class="item row">
                                <div class="col-md-2 col-sm-2 col-xs-12 text-center">
                                    <img class="img-responsive" width="100" height="100" src="head2.jpg" style="display:block; margin:auto;">
                                    <h4 id="replyname">無名</h4>
                                </div>
                                <div class="desc col-md-10 col-sm-10 col-xs-12">
                                    <div class="form-group has-warning">
                                        <input type="text" class="form-control" id="answer_theme">
                                    </div>
                                    <div class="form-group has-warning">
                                        <textarea rows="4" cols="60" placeholder="Content" id="answer_text"></textarea>
                                    </div>
                                    <button class="but" id="answer_postbtn">發送</button>
                                </div><!--//desc-->                          
                            </div><!--//item-->

                        </div><!--//content-->  

                    </div><!--//section-inner-->                 
                </section><!--//section-->
            </div><!--//primary-->

            <div class="primary col-md-1 col-sm-12 col-xs-12">
           </div>
            
		</section>
      </section><!-- /MAIN CONTENT -->

      <!--main content end-->
     
  </section>

    <!-- js placed at the end of the document so the pages load faster -->
    <script src="assets/js/jquery.js"></script>
    <script src="assets/js/bootstrap.min.js"></script>
    <script src="assets/js/jquery-ui-1.9.2.custom.min.js"></script>
    <script src="assets/js/jquery.ui.touch-punch.min.js"></script>
    <script class="include" type="text/javascript" src="assets/js/jquery.dcjqaccordion.2.7.js"></script>
    <script src="assets/js/jquery.scrollTo.min.js"></script>
    <script src="assets/js/jquery.nicescroll.js" type="text/javascript"></script>


    <!--common script for all pages-->
    <script src="assets/js/common-scripts.js"></script>

    <!--script for this page-->
    <script language="javascript">
      var answer_postbtn = document.getElementById("answer_postbtn");
      var answer_text = document.getElementById("answer_text");
      var answer_theme = document.getElementById("answer_theme");
      var replyname = document.getElementById("replyname");
      var strUrl = location.search;
      var getPara, ParaVal;
      var aryPara = [];

      if (strUrl.indexOf("?") != -1) {
        var getSearch = strUrl.split("?");
        getPara = getSearch[1].split("&");
        for (i = 0; i < getPara.length; i++) {
            ParaVal = getPara[i].split("=");
            aryPara.push(ParaVal[0]);
            aryPara[ParaVal[0]] = ParaVal[1];
        }
        console.log(aryPara.id);
      }
      

    //   var filename;

       var storageRef = firebase.storage().ref();
    //     function handlefileselect(evt){
    //     var file = evt.target.files[0];
    //     var metedata={contentType: file.type};
    //     storageRef.child('public/'+file.name).put(file,metedata).then(function(snapshot){
    //         console.log('上傳完成',snapshot);})
    //         .catch(function(error){
    //             console.error('上傳失敗:',error);
    //     });
    // }
    // window.addEventListener('load',function(){
    //     document.getElementById('file').addEventListener('change',handlefileselect);
    // });
     
      var question_text = document.getElementById("question_text");
    firebase.auth().onAuthStateChanged(function(user) {
         window.onload = function() {
            var myLi = document.getElementById("signoutSmtBtn").getElementsByTagName('li');

            var calls = [];
            calls[0] = function() { document.getElementById("logoutDiv").style.display = "block"; document.getElementById("loginDiv").style.display = "none";};
            calls[1] = function() { document.getElementById("loginDiv").style.display = "block"; document.getElementById("logoutDiv").style.display = "none";};
            
            for (i = 0; i < 2; i++) {
                
                myLi[i].addEventListener('click', calls[i], false);
            }
        };
  if (user) {
       document.getElementById("loginDiv").style.display = "none";
            document.getElementById("logoutDiv").style.display = "block";
             signoutSmtBtn.addEventListener("click",function(){
                firebase.auth().signOut().then(function() {
                  console.log("User sign out!");
                  alert("登出成功");
                 // window.location.href = 'blank.html';
                }, function(error) {
                  console.log("User sign out error!");
                  alert("登出失敗");
                })
            },false);
            

    //reply part

        firebase.database().ref('/users/' + user.uid).once('value').then(function(snapshot) {
            replyname.textContent = snapshot.val().username;
        });

    // User is signed in.
        
        User = firebase.auth().currentUser;
        answer_postbtn.addEventListener("click", function(){
            console.log("TEST");
            var newPostRef = firebase.database().ref('/posts/'+aryPara.id+'/reply').push(); // To get reply id key.
            /*firebase.database().ref('/posts/'+aryPara.id+'/reply').push({
                uid: User.uid,
                article_id: aryPara.id,
                reply_id: newPostRef.key,
                answer_theme: answer_theme.value,
                answer_text : answer_text.value,
                replyname: replyname.textContent
            })*/
            newPostRef.set({
                uid: User.uid, //使用者ID
                article_id: aryPara.id, //文章ID
                reply_id: newPostRef.key,   //此回覆ID
                answer_theme: answer_theme.value,
                answer_text : answer_text.value,
                replyname: replyname.textContent
            }).then(function(){
                window.location.href = 'content.html?id='+aryPara.id;
            }).catch(function(error){
                console.error('上傳失敗:',error);
            });
                
        })

        }
        else{
            document.getElementById("loginDiv").style.display = "block";
                    document.getElementById("logoutDiv").style.display = "none";
                    document.getElementById("personalPage").style.pointerEvents = "none"; 
                    username.textContent = "未登入";
                document.getElementById("signout").textContent = "登入"
                console.log("User is not logined yet.");
        }
    }); 
    document.getElementById('share_postbtn').onclick = function() {
        FB.getLoginStatus(function(response) {
            if (response.status === 'connected') {
                console.log('Logged in.');
                FB.ui({
                    method: 'share',
                    display: 'popup',
                    href: location.href,
                }, function(response){});
            }
            else {
                FB.login();
            }
        }); 
    }


    
        
        
    </script>
    <!-- 動態產生文章 -->
    <script src="https://unpkg.com/vue/dist/vue.js"></script>
    <script src="./content.js"></script>

  </body>
</html>
